#!/bin/bash
whois "$1" | awk -F': ' 'BEGIN{split("Registrant Admin Tech",s);split("Name Organization Street City State/Province Postal Code Country Phone Phone Ext Fax Fax Ext Email",f)}{k=$1;v=$0;sub(/^[^:]*:[ \t]*/,"",v);gsub(/[ \t]+$/,"",v);gsub(/^[ \t]+/,"",k);gsub(/[ \t]+$/,"",k);if(k!="")a[k]=v}END{for(i=1;i<=3;i++)for(j=1;j<=12;j++){kn=s[i]" "f[j];val=a[kn];lbl=kn (f[j]~/Ext/?":":"");if(f[j]=="Street" && val!="")val=val" ";if(val=="")val=" ";printf "%s,%s%s",lbl,val,(i==3&&j==12?"":"\n")}}' > "$1.csv"
